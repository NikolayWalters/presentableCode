import numpy as np
import matplotlib.pyplot as plt
from PyAstronomy import pyasl
from matplotlib import gridspec
from pylab import rc
from matplotlib.ticker import (MultipleLocator, FormatStrFormatter,
                               AutoMinorLocator)
from matplotlib import transforms
from pylab import *
rcParams['font.family'] = 'serif'
rcParams['font.sans-serif'] = ['Times']

plt.rc('xtick',c='k')
rc('axes', linewidth=2)
plt.rc('ytick',c='k')
fig, ax1 = plt.subplots(2, 2,gridspec_kw={'hspace': 0.15, 'wspace': 0.05},figsize=(20,20))
ax1[0][0].set_yscale('log')

xlabels=['C', 'Na', 'Mg', 'Al', 'Si', 'Ca', 'Fe']
xaxis = np.linspace(0,6,7)


ax1[0][0].plot([2,3,4,5,6], [6.93391736563295e-16,7.55584147497912e-16,1.27937786762841e-15,7.75238572340336e-16,8.66991450389853e-16], color='gray',marker='o',ls='-', ms=12) #0354
ax1[0][0].plot([2,3,4,5,6], [1.83660222656361e-16,2.19023988049728e-16,8.07543783465942e-16,1.16456629860081e-16,2.0405331735495e-16], color='gray',marker='o', ls='-',ms=12)#0419
ax1[0][0].plot([0,4], [3.568460929959988e-18 , 2.674908054611724e-18], color='gray',marker='o' ,ls='-',ms=12)#2257
ax1[0][0].plot([0,4], [2.6944805525723e-18,3.13147074126614e-18], color='gray',marker='o', ls='-',ms=12)#0710
ax1[0][0].plot([1], [3.296563385397655e-15], marker='s', c='crimson', ls='', ms=12)
ax1[0][0].plot([1], [6.25e-15], marker='$NLTT\,5306$', ms=75, c='crimson')
ax1[0][0].plot([0,4,6], [2.3883159495181517e-17,1.0966390114430455e-17,1.0158268145766127e-17], color='gray',marker='o',ls='-', ms=12)
ax1[0][0].plot([2, 3, 4, 5, 6], [6.8283117963786484e-15, 3.553182543118292e-15, 7.549418752091741e-15,
                          7.585252725485695e-15,1.1726529404795977e-14], color='gray',marker='o', ls='-', ms=12)

x = np.array([5])
y = np.array([1.917388939919167e-18])
y_el = np.array([1e-18])
y_eu = np.array([0])
mask = (y != y_el)
ax1[0][0].errorbar(x, y, yerr=[y_el, y_eu],
            c='crimson', capsize=6.25, elinewidth=1, marker='s',
             linestyle='',uplims=mask, ms=12)
ax1[0][0].plot([5], [3.75e-18], marker='$NLTT\,5306$', ms=75, c='crimson')

wvl, flx = pyasl.read1dFitsSpec('/home/nwal/Desktop/binaries/NLTT_VIS/all/coAddShifted.fits')
flx = flx/np.mean(flx)
ax1[0][1].plot(wvl,flx-0.25,c='k')
ax1[0][1].set_xlim(6525,6599.99999)
ax1[0][1].set_ylim(0.5-0.25,1.5-0.25)

wavel = [3929.000,3929.200,3929.400,3929.600,3929.800,3930.000,3930.200,3930.400,3930.600,3930.800,3931.000,3931.200,3931.400,3931.600,3931.800,3932.000,3932.200,3932.400,3932.600,3932.800,3933.000,3933.200,3933.400,3933.600,3933.800,3934.000,3934.200,3934.400,3934.600,3934.800,3935.000,3935.200,3935.400,3935.600,3935.800,3936.000,3936.200,3936.400,3936.600,3936.800,3937.000]
flux = [0.9776585,0.9989457,0.9855685,0.9989466,1.012660,1.000829,0.9934337,0.9922941,0.9824561,0.9940172,1.015069,1.012661,1.010980,1.003149,0.9903809,0.9783425,0.9782812,0.9840768,1.008155,1.001752,0.9975455,0.9841902,0.9947370,1.014683,1.012356,1.014347,1.002806,0.9962560,0.9863568,0.9714888,0.9928777,1.019592,0.9915661,0.9699916,0.9880240,0.9950954,0.9780828,0.9809298,0.9956195,1.011282,1.018628]
fitW = [3910,3930.000,3930.200,3930.400,3930.600,3930.800,3931.000,3931.200,3931.400,3931.600,3931.800,3932.000,3932.200,3932.400,3932.600,3932.800,3933.000,3933.200,3933.400,3933.600,3933.800,3934.000,3934.200,3934.400,3934.600,3934.800,3935.000,3935.200,3935.400,3935.600,3935.800,3936.000,3960]
fitF = [1,0.9999868,0.9999962,1.000003,1.000007,1.000009,1.000007,1.000000,0.9999884,0.9999720,0.9999504,0.9999221,0.9998861,0.9998316,0.9996856,0.9990997,0.9965021,0.9896932,0.9789521,0.9708929,0.9749404,0.9828236,0.9925515,0.9974833,0.9989650,0.9992378,0.9992337,0.9991788,0.9991097,0.9990342,0.9989522,0.9988638,1]

#ax1[1][1].plot(wavel, flux, c='k')
ax1[1][1].plot(fitW, fitF, c='b')
wvl, flx = pyasl.read1dFitsSpec('/home/nwal/Desktop/toEmail/41/nightSide/NLTT5306C.fits')
ax1[1][1].plot(wvl, flx, c='k')
ax1[1][1].set_xlim(3910,3960)
ax1[1][1].set_ylim(0.58,1.3)

wavel = [5869.000,5869.200,5869.400,5869.600,5869.800,5870.000,5870.200,5870.400,5870.600,5870.800,5871.000,5871.200,5871.400,5871.600,5871.800,5872.000,5872.200,5872.400,5872.600,5872.800,5873.000,5873.200,5873.400,5873.600,5873.800,5874.000,5874.200,5874.400,5874.600,5874.800,5875.000,5875.200,5875.400,5875.600,5875.800,5876.000,5876.200,5876.400,5876.600,5876.800,5877.000,5877.200,5877.400,5877.600,5877.800,5878.000,5878.200,5878.400,5878.600,5878.800,5879.000,5879.200,5879.400,5879.600,5879.800,5880.000,5880.200,5880.400,5880.600,5880.800,5881.000,5881.200,5881.400,5881.600,5881.800,5882.000,5882.200,5882.400,5882.600,5882.800,5883.000,5883.200,5883.400,5883.600,5883.800,5884.000,5884.200,5884.400,5884.600,5884.800,5885.000,5885.200,5885.400,5885.600,5885.800,5886.000,5886.200,5886.400,5886.600,5886.800,5887.000,5887.200,5887.400,5887.600,5887.800,5888.000,5888.200,5888.400,5888.600,5888.800,5889.000,5889.200,5889.400,5889.600,5889.800,5890.000,5890.200,5890.400,5890.600,5890.800,5891.000,5891.200,5891.400,5891.600,5891.800,5892.000,5892.200,5892.400,5892.600,5892.800,5893.000,5893.200,5893.400,5893.600,5893.800,5894.000,5894.200,5894.400,5894.600,5894.800,5895.000,5895.200,5895.400,5895.600,5895.800,5896.000,5896.200,5896.400,5896.600,5896.800,5897.000,5897.200,5897.400,5897.600,5897.800,5898.000,5898.200,5898.400,5898.600,5898.800,5899.000,5899.200,5899.400,5899.600,5899.800,5900.000,5900.200,5900.400,5900.600,5900.800,5901.000,5901.200,5901.400,5901.600,5901.800,5902.000,5902.200,5902.400,5902.600,5902.800,5903.000,5903.200,5903.400,5903.600,5903.800,5904.000,5904.200,5904.400,5904.600,5904.800,5905.000,5905.200,5905.400,5905.600,5905.800,5906.000,5906.200,5906.400,5906.600,5906.800,5907.000,5907.200,5907.400,5907.600,5907.800,5908.000,5908.200,5908.400,5908.600,5908.800,5909.000,5909.200,5909.400,5909.600,5909.800,5910.000,5910.200,5910.400,5910.600,5910.800,5911.000,5911.200,5911.400,5911.600,5911.800,5912.000,5912.200,5912.400,5912.600,5912.800,5913.000,5913.200,5913.400,5913.600,5913.800,5914.000,5914.200,5914.400,5914.600,5914.800,5915.000,5915.200,5915.400,5915.600,5915.800,5916.000,5916.200,5916.400,5916.600,5916.800,5917.000,5917.200,5917.400,5917.600,5917.800,5918.000,5918.200,5918.400,5918.600,5918.800,5919.000,5919.200,5919.400,5919.600,5919.800,5920.000,5920.200,5920.400,5920.600,5920.800,5921.000]
flux = [1.023200,1.016020,0.9928210,0.9924852,0.9944823,0.9993722,1.008798,1.009385,1.007879,0.9990013,1.009175,1.008254,1.013240,0.9972250,1.015678,1.017718,0.9871446,0.9946810,1.011275,1.014339,1.003128,0.9948620,0.9899877,0.9892387,1.007261,1.015097,1.008809,1.000659,0.9841820,0.9903297,0.9895987,0.9886690,0.9920514,1.000020,0.9931806,0.9848154,0.9874117,0.9980849,0.9923726,0.9993616,0.9993599,1.004690,1.003061,1.000165,0.9981720,1.005492,1.001427,0.9823727,0.9935668,0.9992609,0.9839785,0.9762499,0.9810930,0.9911101,1.003678,0.9912760,0.9895861,1.011399,0.9992270,0.9816790,0.9898226,0.9822191,0.9927329,0.9901053,0.9967520,0.9860957,0.9968774,1.007013,0.9963775,0.9933270,0.9895307,0.9743288,0.9828507,0.9994944,0.9840320,0.9918051,1.003715,0.9836618,0.9849723,1.011548,0.9926383,0.9899377,1.006894,0.9950914,0.9899244,0.9979694,0.9952212,0.9767537,0.9825153,0.9800392,0.9877430,0.9985970,1.004815,0.9821207,0.9797906,0.9911626,0.9994180,1.001410,0.9899040,0.9834533,1.000872,0.9874609,0.9580503,0.9123570,0.8875186,0.8585857,0.8834670,0.9339564,0.9522998,0.9736223,0.9874728,0.9859153,0.9828740,0.9758166,0.9958082,0.9840965,0.9771628,1.004888,0.9966871,0.9822790,0.9928515,0.9795340,0.9789856,0.9875871,0.9716306,0.9804037,0.9934068,0.9947881,0.9880950,0.9794731,1.010117,1.009221,0.9828268,0.9652718,0.9375913,0.9146019,0.9232371,0.9547569,1.001767,1.011900,1.011906,0.9862813,0.9656574,0.9716412,0.9684007,0.9848529,0.9908977,0.9832408,1.005335,0.9915286,0.9808238,0.9965624,0.9904513,0.9754335,0.9763332,0.9862698,0.9768756,0.9939442,0.9908774,0.9763355,0.9670727,0.9826393,0.9945170,0.9813762,0.9776348,0.9822999,0.9851844,0.9834989,0.9895779,0.9845910,1.001749,1.015529,0.9779943,0.9679135,0.9831631,0.9810906,1.006770,1.058921,1.032569,0.9959034,0.9819713,0.9863108,0.9822666,0.9845377,0.9833552,0.9871659,1.000012,1.004108,0.9730495,0.9848935,0.9886814,0.9953238,0.9993830,0.9894000,0.9867238,0.9840831,0.9770018,0.9972946,0.9976665,0.9906497,0.9951597,0.9843717,0.9892933,0.9894263,0.9755899,0.9720669,0.9790577,0.9861763,0.9877816,0.9913125,0.9785177,0.9674231,0.9626499,0.9832882,0.9824040,0.9740483,0.9852749,0.9817554,0.9731703,0.9718674,0.9822289,0.9916204,0.9786855,0.9702768,0.9906635,0.9715106,0.9767117,1.000630,0.9891734,0.9886160,0.9849252,0.9807577,0.9974331,0.9674026,0.9746315,0.9682573,0.9718102,0.9842622,0.9818008,0.9854606,0.9893956,0.9699342,0.9775665,0.9691575,0.9621202,0.9772291,0.9727452,0.9680300,0.9774653,0.9701455,0.9642038,0.9653072,0.9595559,0.9614112,0.9685156,0.9707047,0.9684294,0.9545666,0.9585325,0.9869414,0.9944150]
fitW = [5870.000,5870.200,5870.400,5870.600,5870.800,5871.000,5871.200,5871.400,5871.600,5871.800,5872.000,5872.200,5872.400,5872.600,5872.800,5873.000,5873.200,5873.400,5873.600,5873.800,5874.000,5874.200,5874.400,5874.600,5874.800,5875.000,5875.200,5875.400,5875.600,5875.800,5876.000,5876.200,5876.400,5876.600,5876.800,5877.000,5877.200,5877.400,5877.600,5877.800,5878.000,5878.200,5878.400,5878.600,5878.800,5879.000,5879.200,5879.400,5879.600,5879.800,5880.000,5880.200,5880.400,5880.600,5880.800,5881.000,5881.200,5881.400,5881.600,5881.800,5882.000,5882.200,5882.400,5882.600,5882.800,5883.000,5883.200,5883.400,5883.600,5883.800,5884.000,5884.200,5884.400,5884.600,5884.800,5885.000,5885.200,5885.400,5885.600,5885.800,5886.000,5886.200,5886.400,5886.600,5886.800,5887.000,5887.200,5887.400,5887.600,5887.800,5888.000,5888.200,5888.400,5888.600,5888.800,5889.000,5889.200,5889.400,5889.600,5889.800,5890.000,5890.200,5890.400,5890.600,5890.800,5891.000,5891.200,5891.400,5891.600,5891.800,5892.000,5892.200,5892.400,5892.600,5892.800,5893.000,5893.200,5893.400,5893.600,5893.800,5894.000,5894.200,5894.400,5894.600,5894.800,5895.000,5895.200,5895.400,5895.600,5895.800,5896.000,5896.200,5896.400,5896.600,5896.800,5897.000,5897.200,5897.400,5897.600,5897.800,5898.000,5898.200,5898.400,5898.600,5898.800,5899.000,5899.200,5899.400,5899.600,5899.800,5900.000,5900.200,5900.400,5900.600,5900.800,5901.000,5901.200,5901.400,5901.600,5901.800,5902.000,5902.200,5902.400,5902.600,5902.800,5903.000,5903.200,5903.400,5903.600,5903.800,5904.000,5904.200,5904.400,5904.600,5904.800,5905.000,5905.200,5905.400,5905.600,5905.800,5906.000,5906.200,5906.400,5906.600,5906.800,5907.000,5907.200,5907.400,5907.600,5907.800,5908.000,5908.200,5908.400,5908.600,5908.800,5909.000,5909.200,5909.400,5909.600,5909.800,5910.000,5910.200,5910.400,5910.600,5910.800,5911.000,5911.200,5911.400,5911.600,5911.800,5912.000,5912.200,5912.400,5912.600,5912.800,5913.000,5913.200,5913.400,5913.600,5913.800,5914.000,5914.200,5914.400,5914.600,5914.800,5915.000,5915.200,5915.400,5915.600,5915.800,5916.000,5916.200,5916.400,5916.600,5916.800,5917.000,5917.200,5917.400,5917.600,5917.800,5918.000,5918.200,5918.400,5918.600,5918.800,5919.000,5919.200,5919.400,5919.600,5919.800,5920.000]
fitF = [1.000537,1.000445,1.000355,1.000267,1.000178,1.000088,0.9999999,0.9999161,0.9998338,0.9997483,0.9996571,0.9995623,0.9994672,0.9993730,0.9992812,0.9991920,0.9991040,0.9990149,0.9989233,0.9988313,0.9987410,0.9986551,0.9985725,0.9984880,0.9983993,0.9983071,0.9982135,0.9981207,0.9980299,0.9979420,0.9978542,0.9977632,0.9976704,0.9975761,0.9974813,0.9973876,0.9972975,0.9972125,0.9971293,0.9970431,0.9969525,0.9968605,0.9967704,0.9966822,0.9965938,0.9965031,0.9964105,0.9963176,0.9962246,0.9961324,0.9960405,0.9959482,0.9958552,0.9957608,0.9956660,0.9955711,0.9954771,0.9953852,0.9952955,0.9952080,0.9951200,0.9950302,0.9949387,0.9948457,0.9947526,0.9946595,0.9945670,0.9944745,0.9943810,0.9942876,0.9941944,0.9941018,0.9940088,0.9939127,0.9938126,0.9937103,0.9936102,0.9935117,0.9934109,0.9933071,0.9932007,0.9930912,0.9929773,0.9928579,0.9927340,0.9926039,0.9924656,0.9923155,0.9921469,0.9919531,0.9917214,0.9914322,0.9910493,0.9904905,0.9895371,0.9873616,0.9808899,0.9624258,0.9247022,0.8817345,0.8696122,0.9008234,0.9447934,0.9729136,0.9841397,0.9877087,0.9889255,0.9894555,0.9897271,0.9898688,0.9899358,0.9899556,0.9899433,0.9899081,0.9898564,0.9897901,0.9897098,0.9896173,0.9895121,0.9893908,0.9892460,0.9890670,0.9888352,0.9885045,0.9879357,0.9865357,0.9819555,0.9683763,0.9412708,0.9131592,0.9091936,0.9333404,0.9625571,0.9792132,0.9851294,0.9868012,0.9873184,0.9875236,0.9876116,0.9876395,0.9876326,0.9876035,0.9875589,0.9875031,0.9874408,0.9873742,0.9873032,0.9872283,0.9871517,0.9870749,0.9869968,0.9869158,0.9868305,0.9867432,0.9866579,0.9865750,0.9864918,0.9864071,0.9863213,0.9862370,0.9861535,0.9860675,0.9859769,0.9858826,0.9857884,0.9856972,0.9856127,0.9855341,0.9854543,0.9853690,0.9852781,0.9851846,0.9850901,0.9849958,0.9849043,0.9848171,0.9847330,0.9846482,0.9845603,0.9844719,0.9843838,0.9842944,0.9842032,0.9841101,0.9840167,0.9839245,0.9838362,0.9837523,0.9836680,0.9835801,0.9834883,0.9833959,0.9833056,0.9832163,0.9831262,0.9830338,0.9829410,0.9828503,0.9827635,0.9826809,0.9825974,0.9825095,0.9824174,0.9823226,0.9822273,0.9821337,0.9820437,0.9819558,0.9818665,0.9817757,0.9816853,0.9815986,0.9815157,0.9814314,0.9813424,0.9812490,0.9811544,0.9810603,0.9809664,0.9808739,0.9807839,0.9806958,0.9806076,0.9805179,0.9804295,0.9803438,0.9802591,0.9801717,0.9800807,0.9799882,0.9798951,0.9798017,0.9797083,0.9796150,0.9795235,0.9794342,0.9793457,0.9792563,0.9791666,0.9790800,0.9789960,0.9789105,0.9788214,0.9787291,0.9786358,0.9785421,0.9784485,0.9783550,0.9782621,0.9781714,0.9715352]
ax1[1][0].plot(wavel, flux, c='k')
ax1[1][0].plot(fitW, fitF, c='b')
ax1[1][0].set_xlim(min(fitW),max(fitW)-0.0001)
ax1[1][0].set_ylim(0.58,1.3)

ax1[0][0].set_ylim(5e-19,2.5e-14)
ax1[0][0].set_xticks(xaxis)
ax1[0][0].set_xticklabels(xlabels)
#ax1.set_xlim(-1.5,6.5)
ax1[0][0].set_xlabel('Element', fontsize=26)
ax1[0][0].set_ylabel('Measured accretion rate ($M_\odot$yr$^{-1}$)', fontsize=26)
ax1[0][1].set_xlabel('Wavelength (Å)', fontsize=26)
ax1[1][0].set_xlabel('Wavelength (Å)', fontsize=26)
ax1[1][1].set_xlabel('Wavelength (Å)', fontsize=26)
ax1[0][1].set_ylabel('Relative flux', fontsize=26)
ax1[0][1].yaxis.set_label_position("right")
ax1[1][1].set_ylabel('Relative flux', fontsize=26)
ax1[1][0].set_ylabel('Relative flux', fontsize=26)
ax1[1][1].yaxis.set_label_position("right")
ax1[0][0].tick_params(axis='y',which='both', width=2,direction="in",pad=10)
ax1[0][0].tick_params(axis='y',which='major', length=14,direction="in")
ax1[0][0].tick_params(axis='x',which='both', width=2,direction='in')
ax1[0][0].tick_params(axis='x',which='major', length=14,direction='in',pad=10)
ax1[0][0].tick_params(axis='x',which='minor', length=8)
ax1[0][0].tick_params(axis='y',which='minor', length=8,direction='in')
ax1[0][0].tick_params(labelsize=26)
ax1[0][0].xaxis.set_ticks_position('both')
ax1[0][0].yaxis.set_ticks_position('both')


ax1[0][1].tick_params(axis='y',which='both', width=2,direction="in",pad=10)
ax1[0][1].tick_params(axis='y',which='major', length=14,direction="in")
ax1[0][1].tick_params(axis='x',which='both', width=2,direction='in')
ax1[0][1].tick_params(axis='x',which='major', length=14,direction='in',pad=10)
ax1[0][1].tick_params(axis='x',which='minor', length=8)
ax1[0][1].tick_params(axis='y',which='minor', length=8,direction='in')
ax1[0][1].tick_params(labelsize=26)
ax1[0][1].xaxis.set_ticks_position('both')
ax1[0][1].yaxis.set_ticks_position('both')
ax1[0][1].tick_params(labelright='on')
ax1[0][1].yaxis.tick_right()

ax1[1][0].tick_params(axis='y',which='both', width=2,direction="in",pad=10)
ax1[1][0].tick_params(axis='y',which='major', length=14,direction="in")
ax1[1][0].tick_params(axis='x',which='both', width=2,direction='in')
ax1[1][0].tick_params(axis='x',which='major', length=14,direction='in',pad=10)
ax1[1][0].tick_params(axis='x',which='minor', length=8)
ax1[1][0].tick_params(axis='y',which='minor', length=8,direction='in')
ax1[1][0].tick_params(labelsize=26)
ax1[1][0].xaxis.set_ticks_position('both')
ax1[1][0].yaxis.set_ticks_position('both')


ax1[1][1].tick_params(axis='y',which='both', width=2,direction="in",pad=10)
ax1[1][1].tick_params(axis='y',which='major', length=14,direction="in")
ax1[1][1].tick_params(axis='x',which='both', width=2,direction='in')
ax1[1][1].tick_params(axis='x',which='major', length=14,direction='in',pad=10)
ax1[1][1].tick_params(axis='x',which='minor', length=8)
ax1[1][1].tick_params(axis='y',which='minor', length=8,direction='in')
ax1[1][1].tick_params(labelsize=26)
ax1[1][1].xaxis.set_ticks_position('both')
ax1[1][1].yaxis.set_ticks_position('both')
ax1[1][1].tick_params(labelright='on')
ax1[1][1].yaxis.tick_right()

ax1[1][1].annotate('Ca II', (3933.7, 1.1),
                 xycoords="data",
                 textcoords="offset points",
                 xytext=(0, 10), ha="center", fontsize=26)
ax1[1][1].plot([3933.7,3933.7],[1.05,1.1],c='k')

ax1[1][0].annotate('Na I', (5893, 1.1),
                 xycoords="data",
                 textcoords="offset points",
                 xytext=(0, 10), ha="center", fontsize=26)
ax1[1][0].plot([5896,5896],[1.05,1.1],c='k')
ax1[1][0].plot([5890,5890],[1.05,1.1],c='k')

ax1[0][1].annotate('Hα', (6563, 0.9),
                 xycoords="data",
                 textcoords="offset points",
                 xytext=(0, 10), ha="center", fontsize=26)
ax1[0][1].plot([6563,6563],[0.85,0.9],c='k')



ax1[0][0].plot([2.75], [6.25e-15], marker='$1$', c='gray', ms=18)
ax1[0][0].plot([2.75], [1.25e-15], marker='$2$', c='gray', ms=18)
ax1[0][0].plot([2.75], [1.25e-16], marker='$3$', c='gray', ms=18)
ax1[0][0].plot([2.75], [2e-17], marker='$4$', c='gray', ms=18)
ax1[0][0].plot([0], [1.5e-18], marker='$5$', c='gray', ms=18)
ax1[0][0].plot([4], [1.5e-18], marker='$6$', c='gray', ms=18)


bboxx = transforms.Bbox([[0.86, 1.2], [19.2, 17.7]])
plt.savefig('DDTFigure.pdf', bbox_inches=bboxx)